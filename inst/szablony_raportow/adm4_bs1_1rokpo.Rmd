---
title: |
  | Raport roczny z monitoringu karier absolwentów, którzy ukończyli branżową szkołę I stopnia
output:
  pdf_document:
    dev: cairo_pdf
    fig_caption: no
    toc: yes
    toc_depth: 2
lang: pl
papersize: a4
fontsize: 11pt
geometry: margin=20mm
params:
  progLiczebnosci: 10
  typDokumentu: pdf
  wyrownanieTabWykr: center
  rok: 2023
---

```{r setup}
source("setup.R",
       echo = FALSE)
```

`r ifelse(typDokumentu %in% "pdf", "---", "")`

`r ifelse(typDokumentu %in% "pdf", "\\vfill\n\\includegraphics{Belka-Losy-absolwentow-Kolor-PL}", "")`

`r ifelse(typDokumentu %in% "pdf", "\\newpage", "")`

```{r, child="wstep-child.Rmd"}

```

# 2. Ścieżki edukacyjno-zawodowe

W tym rozdziale prezentowanych jest 5 statusów absolwentów opisujących ich sytuację edukacyjno-zawodową w różnych momentach. Poniższa tabela przybliża konstrukcję poszczególnych statusów.

```{r}
statusy_df %>% 
  kable(format = "latex",
        booktabs = TRUE,
        escape = FALSE,
        longtable = TRUE,
        align = "ll",
        linesep = "\\addlinespace") %>% 
  kable_styling(position = wyrownanieTabWykr,
                latex_options = c("hold_position", "repeat_header"),
                repeat_header_text = "(ciąg dalszy tabeli)") %>% 
  column_spec(1, width = "4cm") %>%
  column_spec(2, width = "12cm")
```

```{r}
if (szk$S3_12[[1]]$n >= progLiczebnosci) {
  cat(
    "Spośród absolwentów Państwa szkoły z rocznika ",
    rocznik,
    " w grudniu ",
    params$rok,
    " roku kształciło się ",
    round((szk$S3_12[[1]]$ucz_prac + szk$S3_12[[1]]$tylko_ucz) * 100),
    "%, podczas gdy spośród absolwentów pozostałych branżowych szkół I stopnia z ",
    powiaty_dop,
    " ",
    round((god$S3_12[[1]]$ucz_prac + god$S3_12[[1]]$tylko_ucz) * 100),
    "%.\n\nEdukację w kolejnej szkole ponadpodstawowej z zatrudnieniem na podstawie umowy o pracę lub z wykonywaniem własnej działalności gospodarczej (samozatrudnieniem)^[W przypadku uczniów i studentów do 26. roku życia nie są dostępne dane dotyczące ewentualnego wykonywania pracy na podstawie umów cywilnoprawnych.] łączyło ",
    round(szk$S3_12[[1]]$ucz_prac * 100),
    "% absolwentów Państwa szkoły. Odsetek takich osób wśród absolwentów Państwa szkoły był ",
    case_when(
      round(szk$S3_12[[1]]$ucz_prac * 100) < round(god$S3_12[[1]]$ucz_prac * 100) ~ "niższy niż",
      round(szk$S3_12[[1]]$ucz_prac * 100) > round(god$S3_12[[1]]$ucz_prac * 100) ~ "wyższy niż",
      round(szk$S3_12[[1]]$ucz_prac * 100) %in% round(god$S3_12[[1]]$ucz_prac * 100) ~ "taki sam, jak"
    ),
    " wśród absolwentów pozostałych branżowych szkół I stopnia z ", 
    powiaty_dop,
    " (",
    round(god$S3_12[[1]]$ucz_prac * 100),
    "%), z tego samego rocznika.\n\nW tym samym miesiącu ",
    round(szk$S3_12[[1]]$tylko_prac * 100),
    "% absolwentów Państwa szkoły pracowało^[Na podstawie umowy o pracę, umowy cywilnoprawnej lub prowadząc własną działalność gospodarczą.], ale nie uczęszczało do kolejnej szkoły. Do grupy pracujących, ale nie kontynuujących edukacji formalnej należało ",
    round(god$S3_12[[1]]$tylko_prac * 100),
    "% absolwentów z ",
    powiaty_dop,
    ".\n\nSpośród absolwentów Państwa szkoły w grudniu ",
    params$rok,
    " roku ",
    round(szk$S3_12[[1]]$neet * 100),
    "% nie kontynuowało nauki w kolejnej szkole ponadpodstawowej ani nie wykonywało pracy odnotowywanej przez ZUS^[Na podstawie umowy o pracę, na podstawie umowy cywilnoprawnej ani prowadząc własną działalność gospodarczą.]. W takiej samej sytuacji było ",
    round(god$S3_12[[1]]$neet * 100),
    "% absolwentów pozostałych branżowych szkół I stopnia z ",
    powiaty_dop,
    ".\n",
    sep = ""
  )
} else {
  cat("Liczba absolwentów Państwa szkoły nie była wystarczająca, żeby możliwe było przedstawienie wyników zgodnie z zasadą chroniącą anonimowość absolwentów.")
}
```

```{r}
if (szk$S3_12[[1]]$n >= progLiczebnosci) {
  nazwy_wierszy = c(
    "Nauka i praca",
    "Tylko nauka",
    "Tylko praca",
    "Zarejestrowany jako bezrobotny",
    "Brak nauki i brak pracy")
  
  tab = tab_wykres(szk$S3_12[[1]],
                   god$S3_12[[1]],
                   NULL,
                   powiaty_dop,
                   nazwy_wierszy,
                   szk$typ_szk[[1]],
                   80) %>% 
    mutate(name = ordered(name, levels = c("Brak nauki i brak pracy",
                                           "Zarejestrowany jako bezrobotny",
                                           "Tylko praca",
                                           "Nauka i praca",
                                           "Tylko nauka")))
  
  wykres = wykres_poziomy_statusy(
    tab,
    wrapper(paste0("Wykres ",
                   wyk_num(),
                   ": Status edukacyjno-zawodowy absolwentów Państwa szkoły oraz absolwentów pozostałych branżowych szkół I stopnia z ",
                   powiaty_dop,
                   ", w grudniu ",
                   params$rok,
                   " roku - ogółem"), 80))
  
  levels(tab$typ) = linebreak(levels(tab$typ), align = "l")
  
  tabela = tab %>% 
    mutate(across(name,
                  ~ordered(name,
                           levels = c("Brak nauki i brak pracy",
                                      "Zarejestrowany jako bezrobotny",
                                      "Tylko praca",
                                      "Nauka i praca",
                                      "Tylko nauka"),
                           labels = c("neet", "bezrob", "tylko_prac", "ucz_prac", "tylko_ucz")))) %>% 
    select(-lab) %>% 
    pivot_wider(names_from = name) %>% 
    select(typ, tylko_ucz, ucz_prac, tylko_prac, neet) %>% 
    mutate(across(tylko_ucz:neet,
                  ~ round(. * 100))) %>%
    mutate(across(tylko_ucz:neet,
                  ~ paste0(., "\\%"))) %>%
    kable(format = "latex", booktabs = TRUE, escape = FALSE, longtable = TRUE,
          linesep = "",
          align = "lccccc",
          col.names = NULL,
          digits = 0) %>% 
    kable_styling(position = wyrownanieTabWykr,
                  latex_options = c("hold_position", "repeat_header"),
                  font_size = 10,
                  full_width = TRUE,
                  repeat_header_text = "(ciąg dalszy tabeli)") %>% 
    add_header_above(c("", "1" = 1, "2" = 1, "3" = 1, "4" = 1, "5" = 1),
                     align = c("l", "c", "c", "c", "c", "c")) %>%
    add_header_above(c(" ",
                       "1. Tylko nauka\n2. Nauka i praca\n3. Tylko praca\n4. Zarejestrowany jako bezrobotny\n5. Brak nauki i brak pracy" = 5),
                     align = c("c", "l")) %>% 
    column_spec(1, width = "5cm") %>%
    column_spec(2, width = "2.25cm") %>%
    column_spec(3, width = "2.25cm") %>%
    column_spec(4, width = "2.25cm") %>%
    column_spec(5, width = "2.25cm")%>%
    column_spec(6, width = "2.25cm")
  
  zwroc_wykres_tabela(wykres, tabela)
}
```

```{r}
if (szk$S3_12[[1]]$n >= progLiczebnosci) {
  tab_s3_zaw_check = szk$tab_s3_zaw[[1]] %>% 
    as_tibble()
  if (nrow(tab_s3_zaw_check) > 0) {
    tab_s3_zaw_check = tab_s3_zaw_check %>%  
      filter(!row_number() %in% nrow(.)) %>%
      filter(n >= 10) %>% 
      arrange(n, nazwa_zaw) %>%
      mutate(typ = ordered(.$nazwa_zaw, levels = unique(.$nazwa_zaw))) %>% 
      select(-c(n, nazwa_zaw))
  } else {
    tab_s3_zaw_check = tibble()
  }
  
  if (nrow(tab_s3_zaw_check) %in% 0) {
    cat("W przypadku żadnego zawodu liczba absolwentów Państwa szkoły nie była wystarczająca, żeby możliwe było przedstawienie wyników w tym ujęciu zgodnie z zasadą chroniącą anonimowość absolwentów.")
  } else if (nrow(tab_s3_zaw_check) %in% 1) {
    cat("Poniższy wykres przedstawia sytuację absolwentów wykształconych w Państwa szkole w zawodzie, w którym kształciło się co najmniej 10 osób.")
  } else if (nrow(tab_s3_zaw_check) > 1) {
    cat("Poniższe tabele i wykresy przedstawiają sytuację absolwentów Państwa szkoły wykształconych w poszczególnych zawodach, o ile kształciło się w nich co najmniej 10 osób.")
  }
}
```

```{r}
if (szk$S3_12[[1]]$n >= progLiczebnosci) {
  if (nrow(tab_s3_zaw_check) > 0) {
    szkozaw = szkozaw %>% 
      filter(id_szk %in% szk$id_szk)
    
    for (i in tab_s3_zaw_check$typ) {
      tab_szk = tab_s3_zaw_check[tab_s3_zaw_check$typ %in% i,]
      
      tab_god = szkozaw %>% 
        filter(nazwa_zaw %in% i)
      
      if (nrow(tab_god) > 0) {
        zawod = wrapper(unique(tab_god$nazwa_zaw), 35)
        
        terytorium = tab_god$odniesieniePoziom[[1]]
        
        tab_god = tab_god$S3_12[[1]] %>% 
          as_tibble() %>% 
          cbind(., zawod) %>% 
          rename(nazwa_zaw = zawod) %>% 
          mutate(typ = ordered(x = .$nazwa_zaw, levels = unique(.$nazwa_zaw))) %>% 
          select(-c(n, nazwa_zaw))
        
        powiaty_dop_petla = powiaty %>%
          filter(teryt_pow %in% szk$teryt_pow[[1]]) %>%
          select(starts_with(terytorium)) %>%
          as.character()
        
        tab_szk$typ = "Państwa szkoła"
        tab_god$typ = paste0("Pozostałe branżowe szkoły I stopnia\nz ", powiaty_dop_petla)
        
        tabela = rbind(tab_szk, tab_god) %>% 
          pivot_longer(cols = ucz_prac:neet, names_to = "name") %>% 
          mutate(across(name,
                        ~case_when(
                          . %in% "ucz_prac" ~ "Nauka i praca",
                          . %in% "tylko_ucz" ~ "Tylko nauka",
                          . %in% "tylko_prac" ~ "Tylko praca",
                          . %in% "bezrob" ~ "Zarejestrowany jako bezrobotny",
                          . %in% "neet" ~ "Brak nauki i brak pracy"))) %>% 
          mutate(lab = ifelse(round(value, 2) >= 0.06,
                              paste0(round(value * 100), "%"),
                              ""),
                 name = ordered(name, levels = c("Brak nauki i brak pracy",
                                                 "Zarejestrowany jako bezrobotny",
                                                 "Tylko praca",
                                                 "Nauka i praca",
                                                 "Tylko nauka")))
        
        wyk_tyt = wrapper(paste0("Wykres ",
                                 wyk_num(),
                                 ": Status edukacyjno-zawodowy absolwentów Państwa szkoły oraz absolwentów pozostałych branżowych szkół I stopnia z ",
                                 powiaty_dop_petla,
                                 ", w grudniu ",
                                 params$rok,
                                 " roku - w zawodzie ",
                                 i), 85)
      } else {
        tab_szk$typ = "Państwa szkoła"
        zawod = wrapper(paste0(i), 35)
        
        tabela = tab_szk %>% 
          pivot_longer(cols = ucz_prac:neet, names_to = "name") %>% 
          mutate(across(name,
                        ~case_when(
                          . %in% "ucz_prac" ~ "Nauka i praca",
                          . %in% "tylko_ucz" ~ "Tylko nauka",
                          . %in% "tylko_prac" ~ "Tylko praca",
                          . %in% "bezrob" ~ "Zarejestrowany jako bezrobotny",
                          . %in% "neet" ~ "Brak nauki i brak pracy"))) %>% 
          mutate(lab = ifelse(round(value, 2) >= 0.06,
                              paste0(round(value * 100), "%"),
                              ""),
                 name = ordered(name, levels = c("Brak nauki i brak pracy",
                                                 "Zarejestrowany jako bezrobotny",
                                                 "Tylko praca",
                                                 "Nauka i praca",
                                                 "Tylko nauka")))
        
        wyk_tyt = wrapper(paste0("Wykres ",
                                 wyk_num(),
                                 ": Status edukacyjno-zawodowy absolwentów Państwa szkoły w grudniu ",
                                 params$rok,
                                 " roku - w zawodzie ",
                                 i), 85)
      }
      
      wykres = wykres_poziomy_statusy(
        tabela,
        wyk_tyt)
      
      levels(tabela$typ) = linebreak(levels(tabela$typ), align = "l")
      
      tabela = rbind(tab_szk, tab_god) %>% 
        select(typ, tylko_ucz, ucz_prac, tylko_prac, neet) %>% 
        mutate(across(tylko_ucz:neet,
                      ~ round(. * 100))) %>%
        mutate(across(tylko_ucz:neet,
                      ~ paste0(., "\\%"))) %>%
        kable(format = "latex", booktabs = TRUE, escape = FALSE, longtable = TRUE,
              linesep = "",
              align = "lccccc",
              col.names = NULL,
              digits = 0) %>% 
        kable_styling(position = wyrownanieTabWykr,
                      latex_options = c("hold_position", "repeat_header"),
                      font_size = 10,
                      full_width = TRUE,
                      repeat_header_text = "(ciąg dalszy tabeli)") %>% 
        add_header_above(c(zawod, "1" = 1, "2" = 1, "3" = 1, "4" = 1, "5" = 1),
                         align = c("l", "c", "c", "c", "c", "c")) %>%
        add_header_above(c(" ",
                           "1. Tylko nauka\n2. Nauka i praca\n3. Tylko praca\n4. Zarejestrowany jako bezrobotny\n5. Brak nauki i brak pracy" = 5),
                         align = c("c", "l")) %>% 
        column_spec(1, width = "5cm") %>%
        column_spec(2, width = "2.25cm") %>%
        column_spec(3, width = "2.25cm") %>%
        column_spec(4, width = "2.25cm") %>%
        column_spec(5, width = "2.25cm") %>%
        column_spec(6, width = "2.25cm")
      
      zwroc_wykres_tabela(wykres, tabela)
      
      if (nrow(tab_god) %in% 0) {
        cat("Liczba absolwentów w grupie odniesienia lub szkół do których uczęszczali nie była wystarczająca, żeby możliwe było przedstawienie dla niej wyników zgodnie z zasadą chroniącą anonimowość absolwentów.")
      }
    }
  }
}
```

```{r}
if (szk$S3_12[[1]]$n >= progLiczebnosci) {
  lip_sier = c(
    "lipcu" = round(szk$S3_07[[1]]$ucz_prac * 100),
    "sierpniu" = round(szk$S3_08[[1]]$ucz_prac * 100))
  
  wrz_gru = c(
    "wrześniu" = round(szk$S3_09[[1]]$ucz_prac * 100) + round(szk$S3_09[[1]]$tylko_prac * 100),
    "październiku" = round(szk$S3_10[[1]]$ucz_prac * 100) + round(szk$S3_10[[1]]$tylko_prac * 100), 
    "listopadzie" = round(szk$S3_11[[1]]$ucz_prac * 100) + round(szk$S3_11[[1]]$tylko_prac * 100),
    "grudniu" = round(szk$S3_12[[1]]$ucz_prac * 100) + round(szk$S3_12[[1]]$tylko_prac * 100))
  
  cat(
    "W ",
    params$rok,
    " roku zmieniały się proporcje pomiędzy grupami uczniów i absolwentów Państwa szkoły, wyodrębnionymi ze względu na aktywność edukacyjną i zawodową.\n\nW okresie od lipca do sierpnia ",
    params$rok,
    " roku^[Tj. do momentu, kiedy obecni absolwenci Państwa szkoły przestali być jej uczniami.] odsetek uczniów ostatnich klas Państwa szkoły pracujących na podstawie umowy o pracę^[W tym na podstawie umowy o pracę w celu przygotowania zawodowego. W tym okresie dla żadnego z obecnych absolwentów Państwa szkoły nie możemy zaobserwować zatrudnienia na podstawie umowy zlecenia, ponieważ byli jeszcze uczniami - w przypadku uczniów i studentów do 26. roku życia nie są dostępne dane dotyczące ewentualnego wykonywania pracy na podstawie umów zleceń] lub samozatrudnionych, wynosił ",
    if (length(unique(lip_sier)) %in% 1) {
      paste0(round(szk$S3_01[[1]]$ucz_prac * 100), "%.\n\n")
    } else {
      paste0(
        "od ",
        min(lip_sier),
        "% (w ",
        paste(names(lip_sier[lip_sier == min(lip_sier)]), collapse = ", "),
        ") do ",
        max(lip_sier),
        "% (w ",
        paste(names(lip_sier[lip_sier == max(lip_sier)]), collapse = ", "),
        ").\n\n",
        sep = ""
      )
    },
    "Natomiast w okresie od września do grudnia ",
    params$rok,
    " odsetek absolwentów Państwa szkoły pracujących na podstawie umowy o pracę, samozatrudnionych, a także - w przypadku osób niekontynuujących nauki - pracujących na podstawie umowy zlecenia, wynosił łącznie ",
    if (length(unique(wrz_gru)) %in% 1) {
      paste0(round(szk$S3_09[[1]]$ucz_prac * 100) + round(szk$S3_09[[1]]$tylko_prac * 100), "%.")
    } else {
      paste0(
        "od ",
        min(wrz_gru),
        ifelse(any(names(wrz_gru)[wrz_gru == min(wrz_gru)] %in% "wrześniu"), paste0("% (we "), paste0("% (w ")),
        paste(names(wrz_gru)[wrz_gru == min(wrz_gru)], collapse = ", "),
        ") do ",
        max(wrz_gru),
        ifelse(any(names(wrz_gru)[wrz_gru == max(wrz_gru)] %in% "wrześniu"), paste0("% (we "), paste0("% (w ")),
        paste(names(wrz_gru)[wrz_gru == max(wrz_gru)], collapse = ", "),
        ").",
        sep = ""
      )
    },
    " Bardziej szczegółowe wyniki, uwzględniające również to czy absolwenci się uczyli, przedstawia poniższy wykres.\n\n",
    sep = ""
  )
}
```

```{r}
szkoly_month = rbind(
  as_tibble(szk$S3_07[[1]]),
  as_tibble(szk$S3_08[[1]]),
  as_tibble(szk$S3_09[[1]]),
  as_tibble(szk$S3_10[[1]]),
  as_tibble(szk$S3_11[[1]]),
  as_tibble(szk$S3_12[[1]]))

if (min(szkoly_month$n) >= progLiczebnosci) {
  tab_szk = szkoly_month %>%
    mutate(month = 7:12) %>% 
    select(-n) %>% 
    pivot_longer(ucz_prac:neet) %>% 
    mutate(across(name,
                  ~case_when(
                    . %in% "ucz_prac" ~ "Nauka i praca",
                    . %in% "tylko_ucz" ~ "Tylko nauka",
                    . %in% "tylko_prac" ~ "Tylko praca",
                    . %in% "bezrob" ~ "Zarejestrowany jako bezrobotny",
                    . %in% "neet" ~ "Brak nauki i brak pracy"))) %>% 
    mutate(lab = ifelse(round(value, 2) >= 0.06,
                        paste0(round(value * 100), "%"),
                        "")) %>% 
    mutate(name = ordered(name, levels = c("Brak nauki i brak pracy",
                                           "Zarejestrowany jako bezrobotny",
                                           "Tylko praca",
                                           "Nauka i praca",
                                           "Tylko nauka")))
  
  tab_szk$month = factor(tab_szk$month, ordered = TRUE)
  
  wykres = wykres_pionowy_statusy(tab_szk,
                                  wrapper(paste0("Wykres ",
                                                 wyk_num(),
                                                 ": Status edukacyjno-zawodowy absolwentów Państwa szkoły w poszczególnych miesiącach ",
                                                 params$rok,
                                                 " roku - ogółem (%)"), 80)) +
    scale_x_discrete(labels = c("7" = "lip", "8" = "sie", "9" = "wrz", "10" = "paź", "11" = "lis", "12" = "gru"))
  
  tabelka = szkoly_month %>%
    mutate(month = 7:12) %>% 
    select(-n) %>% 
    mutate(across(ucz_prac:neet,
                  ~ round(. * 100))) %>%
    mutate(across(ucz_prac:neet,
                  ~ paste0(., "\\%"))) %>% 
    pivot_longer(-month, names_to = "mies") %>%
    pivot_wider(names_from = month, values_from = value) %>% 
    mutate(mies = ordered(mies,
                          levels = c(
                            "tylko_ucz",
                            "ucz_prac",
                            "tylko_prac",
                            "bezrob",
                            "neet"),
                          labels = c(
                            "Tylko nauka",
                            "Nauka i praca",
                            "Tylko praca",
                            "Zarejestrowany jako bezrobotny",
                            "Brak nauki i brak pracy"))) %>% 
    arrange(mies) %>% 
    kable("latex", booktabs = TRUE, escape = FALSE, longtable = TRUE,
          linesep = "",
          align = "lcccccc",
          col.names = NULL,
          digits = 0) %>% 
    kable_styling(position = wyrownanieTabWykr,
                  latex_options = c("hold_position", "repeat_header"),
                  font_size = 10,
                  full_width = TRUE,
                  repeat_header_text = "(ciąg dalszy tabeli)") %>% 
    add_header_above(c("", "lip" = 1, "sie" = 1, "wrz" = 1, "paź" = 1, "lis" = 1, "gru" = 1),
                     align = c("l", "c", "c", "c", "c", "c", "c")) %>% 
    column_spec(1, width = "3.9cm") %>%
    column_spec(2, width = "0.8cm") %>%
    column_spec(3, width = "0.8cm") %>%
    column_spec(4, width = "0.8cm") %>%
    column_spec(5, width = "0.8cm") %>%
    column_spec(6, width = "0.8cm") %>%
    column_spec(7, width = "0.8cm") %>% 
    column_spec(8, width = "0.8cm")
  
  zwroc_wykres_tabela(wykres, tabelka)
}
```

`r ifelse(typDokumentu %in% "pdf", "\\newpage", "")`

# 3. Kontynuowanie nauki

## Sposoby kontynuowania kształcenia w grudniu `r params$rok` roku

```{r}
if (szk$E2_nauka_kontyn[[1]]$n >= progLiczebnosci) {
  kontyn = as_tibble(szk$E2_nauka_kontyn[[1]]) %>% 
    # select(bs2, lodd, kkz, kuz) %>% 
    select(-c(n, brak)) %>% 
    pivot_longer(everything()) %>% 
    mutate(nazwa = case_when(
      name %in% "bs2" ~ paste0("* w branżowych szkołach II stopnia (", round(szk$E2_nauka_kontyn[[1]]$bs2 * 100), "%)"),
      name %in% "lodd" ~ paste0("* w liceach dla dorosłych (", round(szk$E2_nauka_kontyn[[1]]$lodd * 100), "%)"),
      name %in% "spolic" ~ paste0("* w szkole policealnej (", round(szk$E2_nauka_kontyn[[1]]$spolic * 100), "%)"),
      name %in% "studia" ~ paste0("* studiując na uczelni (", round(szk$E2_nauka_kontyn[[1]]$studia * 100), "%)"),
      name %in% "kkz" ~ paste0("* na KKZ (", round(szk$E2_nauka_kontyn[[1]]$kkz * 100), "%)"),
      name %in% "kuz" ~ paste0("* na KUZ (", round(szk$E2_nauka_kontyn[[1]]$kuz * 100), "%)")))
  
  sposoby = kontyn %>% 
    pull(value) %>% 
    sum() %>% 
    round(. * 100)
  
  if (sposoby != 0) {
    if (!sposoby %in% c(50, 100)) {
      cat(
        "Wśród absolwentów Państwa szkoły z rocznika ",
        rocznik,
        " przeważały osoby, które w grudniu ",
        params$rok,
        " roku ",
        if (round(sposoby * 100) < 50) {
          paste0("nie kontynuowały kształcenia (uwzględniono również KKZ i KUZ).\n\n")
        } else if (round(sposoby * 100) > 50) {
          paste0("kontynuowały kształcenie (uwzględniono również KKZ i KUZ).\n\n")
        },
        sep = ""
      )
      
      cat("Absolwenci Państwa szkoły kontynuowali naukę:\n\n")
      kontyn = kontyn %>% 
        arrange(desc(value)) %>% 
        filter(round(value * 100) > 0)
      cat(
        paste(kontyn$nazwa, collapse = "\n")
      )
    } else if (sposoby %in% 100) {
      cat(
        "Wśród absolwentów Państwa szkoły z rocznika ",
        rocznik,
        " w grudniu ",
        params$rok,
        " roku wszyscy kontynuowali kształcenie.\n\n",
        sep = ""
      )
    }
    
    if (round(szk$E2_nauka_kontyn[[1]]$brak * 100) %in% 50) {
      cat(
        "Połowa absolwentów Państwa szkoły nie kontynuowała kształcenia.\n\n"
      )
    }
  } else {
    cat("Żaden z absolwentów Państwa szkoły z rocznika ",
        rocznik,
        " w grudniu ",
        params$rok,
        " roku nie kontynuował nauki w branżowej szkole II stopnia, w liceum dla dorosłych, na Kwalifikacyjnych Kursach Zawodowych ani na Kursach Umiejętności Zawodowych.",
        sep = "")
  }
} else {
  cat("Liczba absolwentów w Państwa szkole nie była wystarczająca, żeby możliwe było przedstawienie wyników zgodnie z zasadą chroniącą anonimowość absolwentów.")
}
```

```{r}
if (szk$E2_nauka_kontyn[[1]]$n >= progLiczebnosci) {
  nazwy_wierszy = c(
    "Branżowa szkoła II stopnia",
    "Liceum dla dorosłych",
    "spolic", # tej etykiety nie będzie bo nie biorę tej kolumny
    "studia", # tej etykiety nie będzie bo nie biorę tej kolumny
    "Kwalifikacyjny Kurs Zawodowy",
    "Kurs Umiejętności Zawodowych",
    "Nie kontynuują kształcenia")
  
  tab = tab_wykres(szk$E2_nauka_kontyn[[1]],
                   NULL,
                   NULL,
                   powiaty_dop,
                   nazwy_wierszy,
                   szk$typ_szk[[1]],
                   80) %>%
    select(-typ) %>% 
    filter(!(name %in% c("spolic", "studia"))) %>% 
    arrange(desc(value))
  
  tab_brak_kont = tab %>% 
    filter(name %in% "Nie kontynuują kształcenia")
  
  tab = rbind(
    tab %>% filter(name != "Nie kontynuują kształcenia"),
    tab_brak_kont
  ) %>% 
    mutate(lab = ifelse(round(value, 2) > 0,
                          paste0(round(value * 100), "%"),
                          ""))
  tab$name = ordered(tab$name, tab$name)
  
  wykres = wykres_poziomy_slupki(
    tab,
    wrapper(paste0("Wykres ",
                   wyk_num(),
                   ": Sposoby kontynuowania nauki przez absolwentów Państwa szkoły w grudniu ",
                   params$rok,
                   " roku - ogółem (%)"), 80))
  
  print(wykres)
  
  cat("\\textcolor{black}{\\relscale{0.75}Odsetki mogą sumować się do więcej niż 100\\% ze względu na możliwość kontynuowania edukacji w więcej niż jednej formie.}")
}
```

## Kontynuowanie nauki w branżowych szkołach II stopnia w poszczególnych branżach

```{r}
if (round(szk$E2_nauka_kontyn[[1]]$bs2 * szk$E2_nauka_kontyn[[1]]$n) >= progLiczebnosci) {
  if (sum(szk$liczebnosc_branze_kont[[1]]$odsetek > 0) %in% 1) {
    cat(
      "Jedyną branżą, w której w grudniu ",
      params$rok,
      " roku absolwenci Państwa szkoły uczyli się w branżowej szkole II stopnia, była branża ",
      szk$liczebnosc_branze_kont[[1]]$branza_kont[szk$liczebnosc_branze_kont[[1]]$odsetek > 0],
      sep = ""
    )
  } else if (sum(szk$liczebnosc_branze_kont[[1]]$odsetek > 0) > 1 & sum(szk$liczebnosc_branze_kont[[1]]$odsetek %in% max(szk$liczebnosc_branze_kont[[1]]$odsetek)) %in% 1) {
    cat(
      "Branżą, w której w grudniu ",
      params$rok,
      " roku najwięcej absolwentów Państwa szkoły uczyło się w branżowych szkołach II stopnia, była branża ",
      szk$liczebnosc_branze_kont[[1]]$branza_kont[szk$liczebnosc_branze_kont[[1]]$odsetek %in% max(szk$liczebnosc_branze_kont[[1]]$odsetek)],
      ". Kształciło się w niej ",
      round(max(szk$liczebnosc_branze_kont[[1]]$odsetek) * 100),
      "% spośród absolwentów, którzy w grudniu ",
      params$rok,
      " roku uczyli się w branżowych szkołach II stopnia.",
      sep = ""
      )
  } else if (sum(szk$liczebnosc_branze_kont[[1]]$odsetek > 0) > 1 & sum(szk$liczebnosc_branze_kont[[1]]$odsetek %in% max(szk$liczebnosc_branze_kont[[1]]$odsetek)) > 1) {
    cat(
      "Branżami, w których w grudniu ",
      params$rok,
      " roku absolwenci Państwa szkoły najczęściej uczyli się w branżowych szkołach II stopnia, były: ",
      paste(
        szk$liczebnosc_branze_kont[[1]]$branza_kont[szk$liczebnosc_branze_kont[[1]]$odsetek %in% max(szk$liczebnosc_branze_kont[[1]]$odsetek)],
        collapse = ", "),
      ".",
      sep = ""
    )
  }
} else {
  cat(
    "Liczba absolwentów Państwa szkoły, którzy w grudniu ",
    params$rok,
    " roku uczyli się w branżowych szkołach II stopnia, nie była wystarczająca, żeby możliwe było przedstawienie wyników dla tej grupy zgodnie z zasadą chroniącą anonimowość absolwentów.",
    sep = "")
}
```

```{r}
if (round(szk$E2_nauka_kontyn[[1]]$bs2 * szk$E2_nauka_kontyn[[1]]$n) >= progLiczebnosci) {
  if (length(szk$liczebnosc_branze_kont[[1]]) > 1) {
    cat("Tabela ",
        tab_num(),
        ": Branże, w których absolwenci Państwa szkoły najczęściej uczyli się w branżowych szkołach II stopnia w grudniu ",
        params$rok,
        " roku - ogółem (%)",
        sep = "")
    
    szk$liczebnosc_branze_kont[[1]] %>% 
      as_tibble() %>% 
      select(-n) %>% 
      slice_max(order_by = odsetek, n = 10, with_ties = FALSE) %>% 
      mutate(across(odsetek,
                    ~paste0(round(. * 100), "\\%"))) %>% 
      kable(format = "latex",
            booktabs = TRUE,
            escape = FALSE,
            longtable = TRUE,
            linesep = "",
            align = "lc",
            col.names = NULL,
            digits = 0) %>%
      kable_styling(position = wyrownanieTabWykr,
                    latex_options = c("hold_position", "repeat_header"),
                    full_width = FALSE,
                    repeat_header_text = "(ciąg dalszy tabeli)") %>%
      add_header_above(c(paste0("Branże, w których absolwenci Państwa\nszkoły uczyli się w BS II w grudniu ", params$rok, " roku"), "% wśród absolwentów uczących się w BS II" = 1),
                       align = c("l", "c")) %>% 
      add_footnote("W tabeli prezentowanych jest maksymalnie 10 branż o najwyższych odsetkach kontynuacji",
                   notation = "none")
  }
}
```

```{r}
l_col = length(szk$branze_zawody[[1]]) - 1
if (length(szk$branze_zawody[[1]]) > 1 & l_col > 0) {
  cat(
    "W poniższej tabeli przedstawione zostały informacje o branżach, w których w branżowych szkołach II stopnia uczyli się absolwenci Państwa szkoły, należący do poszczególnych grup (liczących co najmniej 10 osób) wyróżnionych ze względu na zawód, w którym się w niej kształcili.")
  
  naz_wiersze_nag = character()
  for (i in 1:l_col) {
    naz_wiersze_nag = paste(
      c(naz_wiersze_nag, paste(i, "-", names(szk$branze_zawody[[1]])[i + 1])),
      collapse = "\n")
  }
  wiersze_nag = l_col
  names(wiersze_nag) = paste0("% wśród uczących się w BS II absolwentów Państwa\nszkoły, którzy kształcili się w niej w zawodzie:\n", naz_wiersze_nag)
  
  nagl = rep(1, l_col, by = 1)
  names(nagl) = lapply(1:l_col, as.character)
  
  cat("\n\nTabela ",
      tab_num(),
      ": Branże, w których absolwenci Państwa szkoły najczęściej uczyli się w branżowych szkołach II stopnia w grudniu ",
      params$rok,
      " roku - w grupach wyróżnionych ze względu na zawód wyuczony w branżowej szkole I stopnia (%)",
      sep = "")
  
  # tu nie ma ograniczenia na max 10 branż, natomiast jest ograniczenie na liczbę zawodów
  szk$branze_zawody[[1]] %>% 
    as_tibble() %>% 
    mutate(across(2:ncol(.),
                  ~paste0(round(. * 100), "\\%"))) %>% 
    kable(format = "latex",
          booktabs = TRUE,
          escape = FALSE,
          longtable = TRUE,
          linesep = "",
          # align = "lcccccccc",
          col.names = NULL,
          digits = 0) %>%
    kable_styling(position = wyrownanieTabWykr,
                  latex_options = c("hold_position", "repeat_header"),
                  full_width = FALSE,
                  repeat_header_text = "(ciąg dalszy tabeli)") %>%
    add_header_above(header = c(paste0("Branże, w których absolwenci Państwa\nszkoły uczyli się w BS II w grudniu ", params$rok, " roku"), nagl),
                     align = "l") %>% 
    add_header_above(header = c(" ", wiersze_nag), align = "l")
} 

if (round(szk$E2_nauka_kontyn[[1]]$bs2 * szk$E2_nauka_kontyn[[1]]$n) >= progLiczebnosci & !(length(szk$branze_zawody[[1]]) > 1 & l_col > 0)) {
  cat("Żadna grupa uczących się w branżowych szkołach II stopnia absolwentów Państwa szkoły wyróżniona ze względu na zawód, którego uczyli się w BS I, nie liczyła co najmniej 10 osób. Dlatego, zgodnie z zasadą chroniącą anonimowość absolwentów, informacje dotyczące branż, w których w branżowych szkołach II stopnia uczyli się absolwenci Państwa szkoły wykształceni w poszczególnych zawodach nie zostały przedstawione.")
}
```

`r ifelse(typDokumentu %in% "pdf", "\\newpage", "")`

# 4. Praca po ukończeniu branżowej szkoły I stopnia

## Odsetek miesięcy, w których absolwenci pracowali od września do grudnia `r params$rok` roku

Poszczególni absolwenci w okresie od września do grudnia `r params$rok` roku mogli pracować w ciągu maksymalnie 4 miesięcy. W takim przypadku wartość wskaźnika dla danego absolwenta wynosi 100%. Z kolei wartość minimalną, czyli 0%, wskaźnik przyjmuje dla absolwentów, którzy nie pracowali w tym okresie w ciągu żadnego miesiąca.

W przypadku absolwentów, którzy w danym miesiącu byli uczniami szkoły ponadpodstawowej, bierzemy pod uwagę jedynie pracę na etat oraz samozatrudnienie, ponieważ w ich przypadku brak informacji na temat zatrudnienia na podstawie umów cywilnoprawnych^[Ze względu na brak w rejestrze ZUS danych dotyczące ewentualnego wykonywania pracy na podstawie umów cywilnoprawnych przez uczniów i studentów do 26. roku życia.].

W przypadku absolwentów, którzy w danym miesiącu nie kontynuowali nauki w szkole ponadpodstawowej, jako “pracę” uwzględniamy zarówno pracę na etat oraz samozatrudnienie, jak i pracę na podstawie umowy zlecenia. 

W związku z tym wskaźnik jest prezentowany oddzielnie dla każdej z tych grup^[Ten sam absolwent, jeżeli był uczniem tylko przez część rozpatrywanego okresu, jest uwzględniany w dwóch grupach. Na przykład absolwent, który uczył się od września do listopada a pracował od października do grudnia zostanie uwzględniony z wartością wskaźnika 67% (2/3) w grupie absolwentów będących uczniami oraz z wartością wskaźnika 100% (1/1) w grupie absolwentów nieuczących się.].

### Absolwenci w okresie, gdy kontynuowali naukę

